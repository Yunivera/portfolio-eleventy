---
title: WTF Excel?
---

The other day (actually "the other month") I was working on a simple module to export data from our internal system to Excel files and then import it back. Sometimes the only way to convince some long-term Excel users to use your system is to give them a tool to ease this transition. And if you work for 10-20 year only in Excel, you don't give up on using Excel without fighting. So we decided to make a tool that they can use to import all their existing data into our system. Or to export that data if they want to keep making modifications using Excel instead of our glorious, yet oh-so-slow-but-that's-not-our-fault-because-we-use-a-commercial-framework browser interface.

Our data was basically a nested dictionary containing all kinds of Python objects including pandas DataFrames. So I came up with a schema that stores most of the data in one worksheet separating nested dictionaries with a dot in the column name and stores all the lists, DataFrames and other collections in a separate sheet, referencing them by their worksheet name + row numbers. Anyway, that's not the point of this article. The point is - Excel is incredibly stupid!

## Worksheet's name can't exceed 31 characters

Let's start with the most common problem - worksheet's name can't exceed 31 characters. That's it. No way to change that limit, not even in the newer versions. (TODO: Find why?). If you worked with Excel for a while, you probably encountered this problem already. For me it was a frustrating experience because I work on Mac, so I open Excel files using Numbers application (just for the convenience). And Numbers has no issue with worksheet's name. So when I was exporting Excel files with long names, everything worked fine, but when I deployed the code I started receiving complains from the business users that they get errors when opening Excel files and Excel tries to "recover" their files. WTF? I would expect the error to happen the other way around (so Excel file can't be opened in Numbers because of some incompatibilites, but not that Numbers would work, but Excel would fail). It took a good chunk of time (and my sanity) to figure out what's wrong. Since there is no way to overcome this limitation, I ended up maintaining an internal mapping between "short Excel worksheet names" and our data model.

## Is 941 really 941?

Here is a pop quiz. If you put number 941 in a cell, how do you think Excel will store it?

* A) 941
* B) 940.019273019238 (TODO: Get the actual number)

Well, you saw the title of this article, so obviously it's not going to be A).

And if you don't trust me, you can look inside XML files that Excel uses behind the scenes. Just rename your .xlsx to .zip and you can see what's inside. When you check the file corresponding to that cell, you will see that excel uses ISO format (TODO: check that) and some numbers are stored differently.

Everything looks fine for the user, but problems start when you try to parse that file using openpyxl. What do we do with number 940.8912389123891? Do we round it? Or did the user really mean to put that weird value? Well, good luck figuring that out.

## Data vs datetime

This is a more Python specific problem. You can't have just a date in Excel. It's always a datetime (date + time) object. Take a date (from the built-in [datetime]<https://docs.python.org/3/library/datetime.html> module), export it to an Excel file, import it back and voilà - you get a datetime.

## Store numbers as text

Another thing that is probably a bread and butter for someone using Excel on a daily basis, but a huge WFT for me. Let's say you want to store a number as text (so a string) in a cell. You can change the format of that cell to a number and ... it won't work (after importing this number back with openpyxl, you still end up with a number). So maybe you can wrap your number in quotes? (TODO: Check if that works) No, that won't work either. But! You can add ' (a single quote character) at the beginning of that number and then Excel (and openpyxl) will treat it as a text! Totally makes sense, right?


Conclusions:

As for a platform that underlies probably most of the financial system in the world (https://starecat.com/the-whole-world-financial-systems-held-by-excel/), Excel has some incredibly weird limitations and quirks. If you also had some WTF moments working with it, let me know in the comments!

## TODO: here

* replace curly quotes (‘ , ’, “, ”) with straight quotes [https://typographyforlawyers.com/straight-and-curly-quotes.html] using "replace curly quotes command"
* change filename (and date)
  * make sure no other file is referencing this one by filename (update it if needed!)
* capitalize title [https://capitalizemytitle.com/]
* update title
* update categories
* update summary and description
* find hero image
* change the featured-img, image
* remove "published: false"
